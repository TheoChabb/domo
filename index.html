<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Accueil</title>
  <link rel="stylesheet" href="styles/style2.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <h1>Bienvenue sur votre site s√©curis√© !</h1>
  <p id="user-info"></p>
  <button id="logoutBtn">Se d√©connecter</button>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    emailjs.init('TsfbNCBs576Ka422a'); // Ton public key
  </script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC9npt7PuRmlNUcPSFQbhQL5lkT3rejNKQ",
      authDomain: "securisation-domotique.firebaseapp.com",
      projectId: "securisation-domotique",
      storageBucket: "securisation-domotique.firebasestorage.app",
      messagingSenderId: "493865233555",
      appId: "1:493865233555:web:25f2adb612c3b98da9b166",
      measurementId: "G-F4KHR48KZR"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // fonction pour envoyer un email avec EmailJS (sans formulaire)
    function sendMail(title, name, message, email) {
      const serviceID = "default_service";
      const templateID = "template_r2fhmko";

      const params = {
        title: title,
        name: name,
        message: message,
        email: email
      };

      emailjs.send(serviceID, templateID, params)
        .then(() => console.log("üìß Mail envoy√©"))
        .catch(err => console.error("Erreur envoi mail:", err));
    }

    // V√©rifie si connect√©
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        document.getElementById("user-info").innerText =
          "Connect√© en tant que : " + user.email;

        // Envoi auto email
        sendMail(
          "Nouvelle connexion !",
          "domo@contact.fr",
          "Nouvelle connexion √† votre espace de domotique avec ce compte !\n\n" +
          "V√©rifiez qu'il s'agisse bien de vous : https://theochabb.github.io/domo/\n" +
          "Si ce n'est pas vous contactez le support au plus vite !",
          user.email
        );
      }
    });

    // D√©connexion
    function logout() {
      const user = auth.currentUser;
      if (user) {
        sendMail(
          "Alerte s√©curit√©",
          "domo@contact.fr",
          "Nouvelle tentative de connexion √† votre espace de domotique avec un mot de passe erron√© !",
          user.email
        );
      }
      auth.signOut()
        .then(() => {
          window.location.href = "login.html";
        })
        .catch(error => {
          alert("Erreur : " + error.message);
        });
    }

    document.getElementById("logoutBtn").addEventListener("click", logout);
  </script>
</body>
</html>
